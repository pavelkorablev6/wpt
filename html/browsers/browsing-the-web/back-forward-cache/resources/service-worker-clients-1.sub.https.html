<!doctype html>
<script src="/resources/testharness.js"></script>
<script src="/common/PrefixedLocalStorage.js"></script>
<script src="helper.sub.js"></script>
<iframe></iframe>
<script>
const t = async_test('The page is BFCached');
const iframe = document.querySelector('iframe');
runTest(
  t,
  () => {
    iframe.src = prefixedLocalStorage.url('https://{{host}}:{{ports[https][0]}}/html/browsers/browsing-the-web/back-forward-cache/resources/clients-matchall-iframe.html?key=clients-1');
    iframe.onload = t.step_func(() => {
      iframe.contentWindow.postMessage('start', '*');
      window.onmessage = () => {
        location.href = prefixedLocalStorage.url('https://{{hosts[alt][www]}}:{{ports[https][0]}}/html/browsers/browsing-the-web/back-forward-cache/resources/service-worker-clients-2.sub.https.html');
      };
    });
  },
  (isBFCached, observedEvents) => {
    assert_implements_optional(isBFCached, 'Should be BFCached');

    iframe.src = prefixedLocalStorage.url('https://{{host}}:{{ports[https][0]}}/html/browsers/browsing-the-web/back-forward-cache/resources/clients-matchall-iframe.html?key=clients-3');
    iframe.onload = t.step_func(() => {
      iframe.contentWindow.postMessage('start', '*');
      window.onmessage = () => t.done();
    });
  }
);
</script>
